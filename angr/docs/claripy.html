
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Claripy Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="concretization_strategies.html" />
    
    
    <link rel="prev" href="structured_data.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Introductory Errata
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../INSTALL.html">
            
                <a href="../INSTALL.html">
            
                    
                    Installing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../HACKING.html">
            
                <a href="../HACKING.html">
            
                    
                    How to Contribute
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../HELPWANTED.html">
            
                <a href="../HELPWANTED.html">
            
                    
                    What to Contribute
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="faq.html">
            
                <a href="faq.html">
            
                    
                    Frequently Asked Questions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Core Concepts
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="toplevel.html">
            
                <a href="toplevel.html">
            
                    
                    Top Level Interfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="loading.html">
            
                <a href="loading.html">
            
                    
                    Loading a Binary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="solver.html">
            
                <a href="solver.html">
            
                    
                    Solver Engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="states.html">
            
                <a href="states.html">
            
                    
                    Program State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="pathgroups.html">
            
                <a href="pathgroups.html">
            
                    
                    Simulation Managers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="simulation.html">
            
                <a href="simulation.html">
            
                    
                    Execution Engines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="analyses.html">
            
                <a href="analyses.html">
            
                    
                    Analyses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="be_creative.html">
            
                <a href="be_creative.html">
            
                    
                    Remarks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Built-in Analyses
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="analyses/cfg.html">
            
                <a href="analyses/cfg.html">
            
                    
                    CFG
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="analyses/backward_slice.html">
            
                <a href="analyses/backward_slice.html">
            
                    
                    Backward Slicing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="analyses/identifier.html">
            
                <a href="analyses/identifier.html">
            
                    
                    Function Identifier
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Advanced Topics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="gotchas.html">
            
                <a href="gotchas.html">
            
                    
                    Gotchas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="pipeline.html">
            
                <a href="pipeline.html">
            
                    
                    The Whole Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="mixins.html">
            
                <a href="mixins.html">
            
                    
                    The Mixin Pattern
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="speed.html">
            
                <a href="speed.html">
            
                    
                    Optimizing Symbolic Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="file_system.html">
            
                <a href="file_system.html">
            
                    
                    The Emulated Filesystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="ir.html">
            
                <a href="ir.html">
            
                    
                    Intermediate Representation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="structured_data.html">
            
                <a href="structured_data.html">
            
                    
                    Working with Data and Conventions
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.8" data-path="claripy.html">
            
                <a href="claripy.html">
            
                    
                    Claripy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="concretization_strategies.html">
            
                <a href="concretization_strategies.html">
            
                    
                    Symbolic Memory Addressing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="java_support.html">
            
                <a href="java_support.html">
            
                    
                    Java Symbolic Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="symbion.html">
            
                <a href="symbion.html">
            
                    
                    Symbion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Extending angr
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="simprocedures.html">
            
                <a href="simprocedures.html">
            
                    
                    Programming SimProcedures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="state_plugins.html">
            
                <a href="state_plugins.html">
            
                    
                    Writing State Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="environment.html">
            
                <a href="environment.html">
            
                    
                    Extending the Environment Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="exploration_techniques.md">
            
                <span>
            
                    
                    TODO: Writing Exploration Techniques
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="analysis_writing.html">
            
                <a href="analysis_writing.html">
            
                    
                    Writing Analyses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="angr-bf.md">
            
                <span>
            
                    
                    TODO: Adding Support for New Architectures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="angr_management.html">
            
                <a href="angr_management.html">
            
                    
                    Scripting angr management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="examples.html">
            
                <a href="examples.html">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Appendix
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="appendices/ops.html">
            
                <a href="appendices/ops.html">
            
                    
                    List of Claripy Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="appendices/options.html">
            
                <a href="appendices/options.html">
            
                    
                    List of State Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../CHANGELOG.html">
            
                <a href="../CHANGELOG.html">
            
                    
                    Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../MIGRATION.html">
            
                <a href="../MIGRATION.html">
            
                    
                    Migrating to angr 8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="migration-7.html">
            
                <a href="migration-7.html">
            
                    
                    Migrating to angr 7
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Claripy</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="solver-engine">Solver Engine</h1>
<p>angr&apos;s solver engine is called Claripy.
Claripy exposes the following design:</p>
<ul>
<li>Claripy ASTs (the subclasses of claripy.ast.Base) provide a unified way to interact with concrete and symbolic expressions</li>
<li><code>Frontend</code>s provide different paradigms for evaluating these expressions. For example, the <code>FullFrontend</code> solves expressions using something like an SMT solver backend, while <code>LightFrontend</code> handles them by using an abstract (and approximating) data domain backend.</li>
<li>Each <code>Frontend</code> needs to, at some point, do actual operation and evaluations on an AST. ASTs don&apos;t support this on their own. Instead, <code>Backend</code>s translate ASTs into backend objects (i.e., python primitives for <code>BackendConcrete</code>, Z3 expressions for <code>BackendZ3</code>, strided intervals for <code>BackendVSA</code>, etc) and handle any appropriate state-tracking objects (such as tracking the solver state in the case of <code>BackendZ3</code>). Roughly speaking, frontends take ASTs as inputs and use backends to <code>backend.convert()</code> those ASTs into backend objects that can be evaluated and otherwise reasoned about.</li>
<li><code>FrontendMixin</code>s customize the operation of <code>Frontend</code>s. For example, <code>ModelCacheMixin</code> caches solutions from an SMT solver.</li>
<li>The combination of a Frontend, a number of FrontendMixins, and a number of Backends comprise a claripy <code>Solver</code>.</li>
</ul>
<p>Internally, Claripy seamlessly mediates the co-operation of multiple disparate backends -- concrete bitvectors, VSA constructs, and SAT solvers. It is pretty badass.</p>
<p>Most users of angr will not need to interact directly with Claripy (except for, maybe, claripy AST objects, which represent symbolic expressions) -- angr handles most interactions with Claripy internally.
However, for dealing with expressions, an understanding of Claripy might be useful.</p>
<h2 id="claripy-asts">Claripy ASTs</h2>
<p>Claripy ASTs abstract away the differences between mathematical constructs that Claripy supports.
They define a tree of operations (i.e., <code>(a + b) / c)</code> on any type of underlying data.
Claripy handles the application of these operations on the underlying objects themselves by dispatching requests to the backends.</p>
<p>Currently, Claripy supports the following types of ASTs:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Supported By (Claripy Backends)</th>
<th>Example Code</th>
</tr>
</thead>
<tbody>
<tr>
<td>BV</td>
<td>This is a bitvector, whether symbolic (with a name) or concrete (with a value). It has a size (in bits).</td>
<td>BackendConcrete, BackendVSA, BackendZ3</td>
<td><ul><li>Create a 32-bit symbolic bitvector &quot;x&quot;: `claripy.BVS(&apos;x&apos;, 32)`</li><li>Create a 32-bit bitvector with the value `0xc001b3475`: `claripy.BVV(0xc001b3a75, 32)`</li><li>Create a 32-bit &quot;strided interval&quot; (see VSA documentation) that can be any divisible-by-10 number between 1000 and 2000: `claripy.SI(name=&apos;x&apos;, bits=32, lower_bound=1000, upper_bound=2000, stride=10)`</li></ul></td>
</tr>
<tr>
<td>FP</td>
<td>This is a floating-point number, whether symbolic (with a name) or concrete (with a value).</td>
<td>BackendConcrete, BackendZ3</td>
<td><ul><li>Create a `claripy.fp.FSORT_DOUBLE` symbolic floating point &quot;b&quot;: `claripy.FPS(&apos;b&apos;, claripy.fp.FSORT_DOUBLE)`</li><li>Create a `claripy.fp.FSORT_FLOAT` floating point with value `3.2`: `claripy.FPV(3.2, claripy.fp.FSORT_FLOAT)`</li></ul></td>
</tr>
<tr>
<td>Bool</td>
<td>This is a boolean operation (True or False).</td>
<td>BackendConcrete, BackendVSA, BackendZ3</td>
<td><code>claripy.BoolV(True)</code>, or <code>claripy.true</code> or <code>claripy.false</code>, or by comparing two ASTs (i.e., <code>claripy.BVS(&apos;x&apos;, 32) &lt; claripy.BVS(&apos;y&apos;, 32)</code></td>
</tr>
</tbody>
</table>
<p>All of the above creation code returns claripy.AST objects, on which operations can then be carried out.</p>
<p>ASTs provide several useful operations.</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> claripy

<span class="hljs-meta">&gt;&gt;&gt; </span>bv = claripy.BVV(<span class="hljs-number">0x41424344</span>, <span class="hljs-number">32</span>)

<span class="hljs-comment"># Size - you can get the size of an AST with .size()</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> bv.size() == <span class="hljs-number">32</span>

<span class="hljs-comment"># Reversing - .reversed is the reversed version of the BVV</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> bv.reversed <span class="hljs-keyword">is</span> claripy.BVV(<span class="hljs-number">0x44434241</span>, <span class="hljs-number">32</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> bv.reversed.reversed <span class="hljs-keyword">is</span> bv

<span class="hljs-comment"># Depth - you can get the depth of the AST</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>print(bv.depth)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> bv.depth == <span class="hljs-number">1</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>x = claripy.BVS(<span class="hljs-string">&apos;x&apos;</span>, <span class="hljs-number">32</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> (x+bv).depth == <span class="hljs-number">2</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> ((x+bv)/<span class="hljs-number">10</span>).depth == <span class="hljs-number">3</span>
</code></pre>
<p>Applying a condition (==, !=, etc) on ASTs will return an AST that represents the condition being carried out.
For example:</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span>r = bv == x
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> isinstance(r, claripy.ast.Bool)

<span class="hljs-meta">&gt;&gt;&gt; </span>p = bv == bv
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> isinstance(p, claripy.ast.Bool)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> p.is_true()
</code></pre>
<p>You can combine these conditions in different ways.</p>
<pre><code class="lang-python"><span class="hljs-meta">&gt;&gt;&gt; </span>q = claripy.And(claripy.Or(bv == x, bv * <span class="hljs-number">2</span> == x, bv * <span class="hljs-number">3</span> == x), x == <span class="hljs-number">0</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> isinstance(p, claripy.ast.Bool)
</code></pre>
<p>The usefulness of this will become apparent when we discuss Claripy solvers.</p>
<p>In general, Claripy supports all of the normal python operations (+, -, |, ==, etc), and provides additional ones via the Claripy instance object. Here&apos;s a list of available operations from the latter.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>LShR</td>
<td>Logically shifts a bit expression (BVV, BV, SI) to the right.</td>
<td><code>claripy.LShR(x, 10)</code></td>
</tr>
<tr>
<td>SignExt</td>
<td>Sign-extends a bit expression.</td>
<td><code>claripy.SignExt(32, x)</code> or <code>x.sign_extend(32)</code></td>
</tr>
<tr>
<td>ZeroExt</td>
<td>Zero-extends a bit expression.</td>
<td><code>claripy.ZeroExt(32, x)</code> or <code>x.zero_extend(32)</code></td>
</tr>
<tr>
<td>Extract</td>
<td>Extracts the given bits (zero-indexed from the <em>right</em>, inclusive) from a bit expression.</td>
<td>Extract the rightmost byte of x: <code>claripy.Extract(7, 0, x)</code> or <code>x[7:0]</code></td>
</tr>
<tr>
<td>Concat</td>
<td>Concatenates several bit expressions together into a new bit expression.</td>
<td><code>claripy.Concat(x, y, z)</code></td>
</tr>
<tr>
<td>RotateLeft</td>
<td>Rotates a bit expression left.</td>
<td><code>claripy.RotateLeft(x, 8)</code></td>
</tr>
<tr>
<td>RotateRight</td>
<td>Rotates a bit expression right.</td>
<td><code>claripy.RotateRight(x, 8)</code></td>
</tr>
<tr>
<td>Reverse</td>
<td>Endian-reverses a bit expression.</td>
<td><code>claripy.Reverse(x)</code> or <code>x.reversed</code></td>
</tr>
<tr>
<td>And</td>
<td>Logical And (on boolean expressions)</td>
<td><code>claripy.And(x == y, x &gt; 0)</code></td>
</tr>
<tr>
<td>Or</td>
<td>Logical Or (on boolean expressions)</td>
<td><code>claripy.Or(x == y, y &lt; 10)</code></td>
</tr>
<tr>
<td>Not</td>
<td>Logical Not (on a boolean expression)</td>
<td><code>claripy.Not(x == y)</code> is the same as <code>x != y</code></td>
</tr>
<tr>
<td>If</td>
<td>An If-then-else</td>
<td>Choose the maximum of two expressions: <code>claripy.If(x &gt; y, x, y)</code></td>
</tr>
<tr>
<td>ULE</td>
<td>Unsigned less than or equal to.</td>
<td>Check if x is less than or equal to y: <code>claripy.ULE(x, y)</code></td>
</tr>
<tr>
<td>ULT</td>
<td>Unsigned less than.</td>
<td>Check if x is less than y: <code>claripy.ULT(x, y)</code></td>
</tr>
<tr>
<td>UGE</td>
<td>Unsigned greater than or equal to.</td>
<td>Check if x is greater than or equal to y: <code>claripy.UGE(x, y)</code></td>
</tr>
<tr>
<td>UGT</td>
<td>Unsigned greater than.</td>
<td>Check if x is greater than y: <code>claripy.UGT(x, y)</code></td>
</tr>
<tr>
<td>SLE</td>
<td>Signed less than or equal to.</td>
<td>Check if x is less than or equal to y: <code>claripy.SLE(x, y)</code></td>
</tr>
<tr>
<td>SLT</td>
<td>Signed less than.</td>
<td>Check if x is less than y: <code>claripy.SLT(x, y)</code></td>
</tr>
<tr>
<td>SGE</td>
<td>Signed greater than or equal to.</td>
<td>Check if x is greater than or equal to y: <code>claripy.SGE(x, y)</code></td>
</tr>
<tr>
<td>SGT</td>
<td>Signed greater than.</td>
<td>Check if x is greater than y: <code>claripy.SGT(x, y)</code></td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong> The default python <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, and <code>&lt;=</code> are unsigned in Claripy. This is different than their behavior in Z3, because it seems more natural in binary analysis.</p>
<h2 id="solvers">Solvers</h2>
<p>The main point of interaction with Claripy are the Claripy Solvers.
Solvers expose an API to interpret ASTs in different ways and return usable values.
There are several different solvers.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Solver</td>
<td>This is analogous to a <code>z3.Solver()</code>. It is a solver that tracks constraints on symbolic variables and uses a constraint solver (currently, Z3) to evaluate symbolic expressions.</td>
</tr>
<tr>
<td>SolverVSA</td>
<td>This solver uses VSA to reason about values. It is an <em>approximating</em> solver, but produces values without performing actual constraint solves.</td>
</tr>
<tr>
<td>SolverReplacement</td>
<td>This solver acts as a pass-through to a child solver, allowing the replacement of expressions on-the-fly. It is used as a helper by other solvers and can be used directly to implement exotic analyses.</td>
</tr>
<tr>
<td>SolverHybrid</td>
<td>This solver combines the SolverReplacement and the Solver (VSA and Z3) to allow for <em>approximating</em> values. You can specify whether or not you want an exact result from your evaluations, and this solver does the rest.</td>
</tr>
<tr>
<td>SolverComposite</td>
<td>This solver implements optimizations that solve smaller sets of constraints to speed up constraint solving.</td>
</tr>
</tbody>
</table>
<p>Some examples of solver usage:</p>
<pre><code class="lang-python"><span class="hljs-comment"># create the solver and an expression</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>s = claripy.Solver()
<span class="hljs-meta">&gt;&gt;&gt; </span>x = claripy.BVS(<span class="hljs-string">&apos;x&apos;</span>, <span class="hljs-number">8</span>)

<span class="hljs-comment"># now let&apos;s add a constraint on x</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>s.add(claripy.ULT(x, <span class="hljs-number">5</span>))

<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> sorted(s.eval(x, <span class="hljs-number">10</span>)) == [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> s.max(x) == <span class="hljs-number">4</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> s.min(x) == <span class="hljs-number">0</span>

<span class="hljs-comment"># we can also get the values of complex expressions</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>y = claripy.BVV(<span class="hljs-number">65</span>, <span class="hljs-number">8</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span>z = claripy.If(x == <span class="hljs-number">1</span>, x, y)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> sorted(s.eval(z, <span class="hljs-number">10</span>)) == [<span class="hljs-number">1</span>, <span class="hljs-number">65</span>]

<span class="hljs-comment"># and, of course, we can add constraints on complex expressions</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>s.add(z % <span class="hljs-number">5</span> != <span class="hljs-number">0</span>)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> s.eval(z, <span class="hljs-number">10</span>) == (<span class="hljs-number">1</span>,)
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">assert</span> s.eval(x, <span class="hljs-number">10</span>) == (<span class="hljs-number">1</span>,) <span class="hljs-comment"># interestingly enough, since z can&apos;t be y, x can only be 1!</span>
</code></pre>
<p>Custom solvers can be built by combining a Claripy Frontend (the class that handles the actual interaction with SMT solver or the underlying data domain) and some combination of frontend mixins (that handle things like caching, filtering out duplicate constraints, doing opportunistic simplification, and so on).</p>
<h2 id="claripy-backends">Claripy Backends</h2>
<p>Backends are Claripy&apos;s workhorses.
Claripy exposes ASTs to the world, but when actual computation has to be done, it pushes those ASTs into objects that can be handled by the backends themselves.
This provides a unified interface to the outside world while allowing Claripy to support different types of computation.
For example, BackendConcrete provides computation support for concrete bitvectors and booleans, BackendVSA introduces VSA constructs such as StridedIntervals (and details what happens when operations are performed on them, and BackendZ3 provides support for symbolic variables and constraint solving.</p>
<p>There are a set of functions that a backend is expected to implement.
For all of these functions, the &quot;public&quot; version is expected to be able to deal with claripy&apos;s AST objects, while the &quot;private&quot; version should only deal with objects specific to the backend itself.
This is distinguished with Python idioms: a public function will be named func() while a private function will be _func().
All functions should return objects that are usable by the backend in its private methods.
If this can&apos;t be done (i.e., some functionality is being attempted that the backend can&apos;t handle), the backend should raise a BackendError.
In this case, Claripy will move on to the next backend in its list.</p>
<p>All backends must implement a <code>convert()</code> function.
This function receives a claripy AST and should return an object that the backend can handle in its private methods.
Backends should also implement a <code>_convert()</code> method, which will receive anything that is <em>not</em> a claripy AST object (i.e., an integer or an object from a different backend).
If <code>convert()</code> or <code>_convert()</code> receives something that the backend can&apos;t translate to a format that is usable internally, the backend should raise BackendError, and thus won&apos;t be used for that object.
All backends must also implement any functions of the base <code>Backend</code> abstract class that currently raise <code>NotImplementedError()</code>.</p>
<p>Claripy&apos;s contract with its backends is as follows: backends should be able to handle, in their private functions, any object that they return from their private <em>or</em> public functions.
Claripy will never pass an object to any backend private function that did not originate as a return value from a private or public function of that backend.
One exception to this is <code>convert()</code> and <code>_convert()</code>, as Claripy can try to stuff anything it feels like into _convert() to see if the backend can handle that type of object.</p>
<h3 id="backend-objects">Backend Objects</h3>
<p>To perform actual, useful computation on ASTs, Claripy uses backend objects.
A <code>BackendObject</code> is a result of the operation represented by the AST.
Claripy expects these objects to be returned from their respective backends, and will pass such objects into that backend&apos;s other functions.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="structured_data.html" class="navigation navigation-prev " aria-label="Previous page: Working with Data and Conventions">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="concretization_strategies.html" class="navigation navigation-next " aria-label="Next page: Symbolic Memory Addressing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Claripy","level":"1.5.8","depth":2,"next":{"title":"Symbolic Memory Addressing","level":"1.5.9","depth":2,"path":"docs/concretization_strategies.md","ref":"docs/concretization_strategies.md","articles":[]},"previous":{"title":"Working with Data and Conventions","level":"1.5.7","depth":2,"path":"docs/structured_data.md","ref":"docs/structured_data.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"docs/claripy.md","mtime":"2021-07-15T09:05:26.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-08-01T08:40:14.923Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

