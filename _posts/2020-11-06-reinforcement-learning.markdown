---
layout: post
title:  Reinforcement learning
date:   2020-11-06 00:01:01 +0300
image:  2020-11-06-winter.jpg
tags:   [MachineLearning]
---

å¼ºåŒ–å­¦ä¹ å°±æ˜¯ç¨‹åºæˆ–æ™ºèƒ½ä½“ï¼ˆ agent ï¼‰é€šè¿‡ä¸ç¯å¢ƒä¸æ–­åœ°è¿›è¡Œäº¤äº’å­¦ä¹ ä¸€ä¸ªä»ç¯å¢ƒåˆ°åŠ¨ä½œçš„æ˜ å°„ï¼Œå­¦ä¹ çš„ç›®æ ‡å°±æ˜¯ä½¿ç´¯è®¡å›æŠ¥æœ€å¤§åŒ–ã€‚
å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç§è¯•é”™å­¦ä¹ ï¼Œå› å…¶åœ¨å„ç§çŠ¶æ€ï¼ˆç¯å¢ƒï¼‰ä¸‹éœ€è¦å°½é‡å°è¯•æ‰€æœ‰å¯ä»¥é€‰æ‹©çš„åŠ¨ä½œï¼Œé€šè¿‡ç¯å¢ƒç»™å‡ºçš„åé¦ˆï¼ˆå³å¥–åŠ±ï¼‰æ¥åˆ¤æ–­åŠ¨ä½œçš„ä¼˜åŠ£ï¼Œæœ€ç»ˆè·å¾—ç¯å¢ƒå’Œæœ€ä¼˜åŠ¨ä½œçš„æ˜ å°„å…³ç³»ï¼ˆå³ç­–ç•¥ï¼‰ã€‚

### é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹

é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMarkov Decision Processï¼‰é€šå¸¸ç”¨æ¥æè¿°ä¸€ä¸ªå¼ºåŒ–å­¦ä¹ é—®é¢˜ã€‚
æ™ºèƒ½ä½“agentæ ¹æ®å½“å‰å¯¹ç¯å¢ƒçš„è§‚å¯Ÿã€é‡‡å–ã€åŠ¨ä½œè·å¾—ç¯å¢ƒçš„åé¦ˆï¼Œå¹¶ä½¿ç¯å¢ƒå‘ç”Ÿæ”¹å˜çš„å¾ªç¯è¿‡ç¨‹ã€‚

### Q-learning

åœ¨ç°å®çš„å¼ºåŒ–å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œç¯å¢ƒçš„è½¬ç§»æ¦‚ç‡ã€å¥–åŠ±å‡½æ•°å¾€å¾€å¾ˆéš¾å¾—çŸ¥ï¼Œç”šè‡³å¾ˆéš¾å¾—çŸ¥ç¯å¢ƒä¸­æœ‰å¤šå°‘çŠ¶æ€ã€‚è‹¥å­¦ä¹ ç®—æ³•ä¸å†ä¾èµ–äºç¯å¢ƒå»ºæ¨¡ï¼Œåˆ™ç§°ä¸ºå…æ¨¡å‹å­¦ä¹ ï¼Œè’™ç‰¹å¡æ´›å¼ºåŒ–å­¦ä¹ å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ã€‚
è’™ç‰¹å¡æ´›å¼ºåŒ–å­¦ä¹ ä½¿ç”¨å¤šæ¬¡é‡‡æ ·ï¼Œç„¶åæ±‚å–å¹³å‡ç´¯è®¡å¥–èµä½œä¸ºæœŸæœ›ç´¯è®¡å¥–èµçš„è¿‘ä¼¼ã€‚

è’™ç‰¹å¡æ´›å¼ºåŒ–å­¦ä¹ ï¼šç›´æ¥å¯¹çŠ¶æ€åŠ¨ä½œå€¼å‡½æ•°Q(s,aï¼‰è¿›è¡Œä¼°è®¡ï¼Œæ¯é‡‡æ ·ä¸€æ¡è½¨è¿¹ï¼Œå°±æ ¹æ®è½¨è¿¹ä¸­çš„æ‰€æœ‰â€œçŠ¶æ€åŠ¨ä½œâ€åˆ©ç”¨ä¸‹é¢çš„å…¬å¼å¯¹æ¥å¯¹å€¼å‡½æ•°è¿›è¡Œæ›´æ–°ã€‚
$$
Q(s,a)=\frac{Q(s,a)*count(s,a)+R}{count(s,a)+1}
$$

æ¯æ¬¡é‡‡æ ·æ›´æ–°å®Œæ‰€æœ‰çš„â€œçŠ¶æ€åŠ¨ä½œâ€å¯¹æ‰€å¯¹åº”çš„Q(s,a)ï¼Œå°±éœ€è¦æ›´æ–°é‡‡æ ·ç­–ç•¥Ï€ã€‚ä½†ç”±äºç­–ç•¥å¯èƒ½æ˜¯ç¡®å®šæ€§çš„ï¼Œå³ä¸€ä¸ªçŠ¶æ€å¯¹åº”ä¸€ä¸ªåŠ¨ä½œï¼Œå¤šæ¬¡é‡‡æ ·å¯èƒ½è·å¾—ç›¸åŒçš„é‡‡æ ·è½¨è¿¹ï¼Œå› æ­¤éœ€è¦å€ŸåŠ©Îµè´ªå¿ƒç­–ç•¥ï¼š
$$
\begin{eqnarray}
ğ…(ğ’”,ğ’‚)=
\begin{cases}
argmax_aQ(s,a) Â Â  & ä»¥æ¦‚ç‡1âˆ’ğœº \\
éšæœºä»Aä¸­é€‰å–åŠ¨ä½œ    & ä»¥æ¦‚ç‡ğœº
\end{cases}
\end{eqnarray}\\
$$
è’™ç‰¹å¡æ´›å¼ºåŒ–å­¦ä¹ ç®—æ³•éœ€è¦é‡‡æ ·ä¸€ä¸ªå®Œæ•´çš„è½¨è¿¹æ¥æ›´æ–°å€¼å‡½æ•°ï¼Œæ•ˆç‡è¾ƒä½ï¼Œæ­¤å¤–è¯¥ç®—æ³•æ²¡æœ‰å……åˆ†åˆ©ç”¨å¼ºåŒ–å­¦ä¹ ä»»åŠ¡çš„åºè´¯å†³ç­–ç»“æ„ã€‚
Q-learningç®—æ³•ç»“åˆäº†åŠ¨æ€è§„åˆ’ä¸è’™ç‰¹å¡æ´›æ–¹æ³•çš„æ€æƒ³ï¼Œä½¿å¾—å­¦ä¹ æ›´åŠ é«˜æ•ˆã€‚

#### Q-learning ç®—æ³•

â€¦â€¦

## æ·±åº¦å¼ºåŒ–å­¦ä¹ ï¼ˆDRLï¼‰

* ä¼ ç»Ÿå¼ºåŒ–å­¦ä¹ ï¼šçœŸå®ç¯å¢ƒä¸­çš„çŠ¶æ€æ•°ç›®è¿‡å¤šï¼Œæ±‚è§£å›°éš¾ã€‚
* æ·±åº¦å¼ºåŒ–å­¦ä¹ ï¼šå°†æ·±åº¦å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ ç»“åˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡æ·±åº¦ç¥ç»ç½‘ç»œç›´æ¥å­¦ä¹ ç¯å¢ƒï¼ˆæˆ–è§‚å¯Ÿï¼‰ä¸çŠ¶æ€åŠ¨ä½œå€¼å‡½æ•°Q(s,aï¼‰ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œç®€åŒ–é—®é¢˜çš„æ±‚è§£ã€‚

### Deep Q Networkï¼ˆDQNï¼‰

Deep Q Network ï¼ˆDQN ï¼‰ï¼šæ˜¯å°†ç¥ç»ç½‘ç»œ (neural  networkï¼‰å’ŒQ-learningç»“åˆï¼Œåˆ©ç”¨ç¥ç»ç½‘ç»œè¿‘ä¼¼æ¨¡æ‹Ÿå‡½æ•° Q(s,a)ï¼Œè¾“å…¥æ˜¯é—®é¢˜çš„çŠ¶æ€ï¼ˆe.g., å›¾å½¢ï¼‰ï¼Œè¾“å‡ºæ˜¯æ¯ä¸ªåŠ¨ä½œaå¯¹åº”çš„Qå€¼ï¼Œç„¶åä¾æ®Qå€¼å¤§å°é€‰æ‹©å¯¹åº”çŠ¶æ€æ‰§è¡Œçš„åŠ¨ä½œï¼Œä»¥å®Œæˆæ§åˆ¶ã€‚
ç¥ç»ç½‘ç»œçš„å‚æ•°ï¼šåº”ç”¨ç›‘ç£å­¦ä¹ å®Œæˆ

#### å­¦ä¹ æµç¨‹ï¼š

* çŠ¶æ€ s è¾“å…¥ï¼Œè·å¾—æ‰€æœ‰åŠ¨ä½œå¯¹åº”çš„Qå€¼Q(s,a)ã€‚
* é€‰æ‹©å¯¹åº”Qå€¼æœ€å¤§çš„åŠ¨ä½œaâ€²å¹¶æ‰§è¡Œï¼›
* æ‰§è¡Œåç¯å¢ƒå‘ç”Ÿæ”¹å˜ï¼Œå¹¶èƒ½å¤Ÿè·å¾—ç¯å¢ƒçš„å¥–åŠ± r
* åˆ©ç”¨å¥–åŠ±ræ›´æ–°Q(s,a')â€”â€”å¼ºåŒ–å­¦ä¹ 
  åˆ©ç”¨æ–°çš„Q(s,a')æ›´æ–°ç½‘ç»œå‚æ•°â€”â€”ç›‘ç£å­¦ä¹ 

-------------------

2013å¹´ï¼ŒDeep Mindå›¢é˜Ÿåœ¨NIPSä¸Šå‘è¡¨ã€ŠPlaying Atari with Deep Reinforcement Learningã€‹ä¸€æ–‡ï¼Œåœ¨è¯¥æ–‡ä¸­é¦–æ¬¡æå‡ºDeep Reinforcement Learningä¸€è¯ï¼Œå¹¶ä¸”æå‡ºDQNï¼ˆDeep Q Networkï¼‰ç®—æ³•ï¼Œå®ç°äº†ä»çº¯å›¾åƒè¾“å…¥å®Œå…¨é€šè¿‡å­¦ä¹ æ¥ç©Atariæ¸¸æˆã€‚

## è‡ªä¸»å­¦ä¹ Flappy Birdæ¸¸æˆ

ç›®æ ‡ï¼šä½¿ç”¨æ·±åº¦å¼ºåŒ–å­¦ä¹ æ–¹æ³•è‡ªä¸»å­¦ä¹ Flappy Birdæ¸¸æˆç­–ç•¥ï¼Œè¾¾åˆ°ç”šè‡³è¶…è¿‡äººç±»ç©å®¶çš„æ°´å¹³ã€‚

æŠ€æœ¯è·¯çº¿ï¼šDeep Q Network
ä½¿ç”¨å·¥å…·ï¼štensorflow + pygame + cv2

OpenCV æ˜¯ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°çš„è®¡ç®—æœºè§†è§‰åº“ï¼Œå®ç°äº†å¤§é‡çš„å›¾åƒå¤„ç†å’Œè®¡ç®—æœºè§†è§‰æ–¹é¢çš„é€šç”¨ç®—æ³•ã€‚
æœ¬å®éªŒé‡‡ç”¨OpenCvå¯¹é‡‡é›†çš„æ¸¸æˆç”»é¢è¿›è¡Œé¢„å¤„ç†ã€‚

æµ‹è¯•tensorflowæ˜¯å¦å®‰è£…æˆåŠŸ

```assembly
import tensorflow as tf

hello = tf.constant('Hello tensorfolw')
sess = tf.Session()
print(sess.run(hello))
```

### ç¨‹åºä¸æ¨¡æ‹Ÿå™¨äº¤äº’

è®­ç»ƒè¿‡ç¨‹ä¹Ÿå°±æ˜¯ç¥ç»ç½‘ç»œï¼ˆagentï¼‰ä¸æ–­ä¸æ¸¸æˆæ¨¡æ‹Ÿå™¨ï¼ˆEnvironmentï¼‰è¿›è¡Œäº¤äº’ï¼Œé€šè¿‡æ¨¡æ‹Ÿå™¨è·å¾—çŠ¶æ€ï¼Œç»™å‡ºåŠ¨ä½œï¼Œæ”¹å˜æ¨¡æ‹Ÿå™¨ä¸­çš„çŠ¶æ€ï¼Œè·å¾—åé¦ˆï¼Œä¾æ®åé¦ˆæ›´æ–°ç­–ç•¥çš„è¿‡ç¨‹ã€‚

è®­ç»ƒè¿‡ç¨‹è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š

* è§‚å¯ŸæœŸï¼ˆOBSERVEï¼‰ï¼šç¨‹åºä¸æ¨¡æ‹Ÿå™¨è¿›è¡Œäº¤äº’ï¼Œéšæœºç»™å‡ºåŠ¨ä½œï¼Œè·å–æ¨¡æ‹Ÿå™¨ä¸­çš„çŠ¶æ€ï¼Œå°†çŠ¶æ€è½¬ç§»è¿‡ç¨‹å­˜æ”¾åœ¨Dï¼ˆReplay Memoryï¼‰ä¸­ã€‚

  * æ‰“å¼€æ¸¸æˆæ¨¡æ‹Ÿå™¨ï¼Œä¸æ‰§è¡Œè·³è·ƒåŠ¨ä½œï¼Œè·å–æ¸¸æˆçš„åˆå§‹çŠ¶æ€ã€‚
  * æ ¹æ®Îµè´ªå¿ƒç­–ç•¥è·å¾—ä¸€ä¸ªåŠ¨ä½œï¼ˆç”±äºç¥ç»ç½‘ç»œå‚æ•°ä¹Ÿæ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œåœ¨æœ¬é˜¶æ®µå‚æ•°ä¹Ÿä¸ä¼šè¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥ç»Ÿç§°ä¸ºéšæœºåŠ¨ä½œï¼‰ï¼Œå¹¶æ ¹æ®è¿­ä»£æ¬¡æ•°å‡å°Îµçš„å¤§å°ã€‚
  * ç”±æ¨¡æ‹Ÿå™¨æ‰§è¡Œé€‰æ‹©çš„åŠ¨ä½œï¼Œèƒ½å¤Ÿè¿”å›æ–°çš„çŠ¶æ€å’Œåé¦ˆå¥–åŠ±ã€‚
  * å°†ä¸Šä¸€çŠ¶æ€sï¼ŒåŠ¨ä½œaï¼Œæ–°çŠ¶æ€sâ€˜ï¼Œåé¦ˆrç»„è£…æˆï¼ˆsï¼Œaï¼Œsâ€˜ï¼Œrï¼‰æ”¾è¿›Replay Memoryä¸­ç”¨ä½œä»¥åçš„å‚æ•°æ›´æ–°ã€‚
  * æ ¹æ®æ–°çš„çŠ¶æ€sâ€˜ï¼Œæ ¹æ®Îµè´ªå¿ƒç­–ç•¥é€‰æ‹©ä¸‹ä¸€æ­¥æ‰§è¡Œçš„åŠ¨ä½œï¼Œå‘¨è€Œå¤å§‹ï¼Œç›´è‡³è¿­ä»£æ¬¡æ•°åˆ°è¾¾æ¢ç´¢æœŸã€‚

* æ¢ç´¢æœŸï¼ˆEXPLOREï¼‰ï¼šç¨‹åºä¸æ¨¡æ‹Ÿå™¨äº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œä¾æ®Replay Memoryä¸­å­˜å‚¨çš„å†å²ä¿¡æ¯æ›´æ–°ç½‘ç»œå‚æ•°ï¼Œå¹¶éšè®­ç»ƒè¿‡ç¨‹é™ä½éšæœºæ¢ç´¢ç‡Îµã€‚

  æ¢ç´¢æœŸä¸è§‚å¯ŸæœŸçš„å”¯ä¸€åŒºåˆ«åœ¨äºä¼šæ ¹æ®æŠ½æ ·å¯¹ç½‘ç»œå‚æ•°è¿›è¡Œæ›´æ–°ã€‚

  * è¿­ä»£æ¬¡æ•°è¾¾åˆ°ä¸€å®šæ•°ç›®ï¼Œè¿›å…¥æ¢ç´¢æœŸï¼Œæ ¹æ®å½“å‰çŠ¶æ€sï¼Œä½¿ç”¨Îµè´ªå¿ƒç­–ç•¥é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œï¼ˆå¯ä»¥æ˜¯éšæœºåŠ¨ä½œæˆ–è€…ç”±ç¥ç»ç½‘ç»œé€‰æ‹©åŠ¨ä½œï¼‰ï¼Œå¹¶æ ¹æ®è¿­ä»£æ¬¡æ•°å‡å°Îµçš„å€¼ã€‚
  * ç”±æ¨¡æ‹Ÿå™¨æ‰§è¡Œé€‰æ‹©çš„åŠ¨ä½œï¼Œèƒ½å¤Ÿè¿”å›æ–°çš„çŠ¶æ€å’Œåé¦ˆå¥–åŠ±ã€‚
  * å°†ä¸Šä¸€çŠ¶æ€sï¼ŒåŠ¨ä½œaï¼Œæ–°çŠ¶æ€sâ€˜ï¼Œåé¦ˆrç»„è£…æˆï¼ˆsï¼Œaï¼Œsâ€™ï¼Œrï¼‰æ”¾è¿›Replay Memoryä¸­ç”¨ä½œå‚æ•°æ›´æ–°ã€‚
  * ä»Replay Memoryä¸­æŠ½å–ä¸€å®šé‡çš„æ ·æœ¬ï¼Œå¯¹ç¥ç»ç½‘ç»œçš„å‚æ•°è¿›è¡Œæ›´æ–°ã€‚
  * æ ¹æ®æ–°çš„çŠ¶æ€sâ€˜ï¼Œæ ¹æ®Îµè´ªå¿ƒç­–ç•¥é€‰æ‹©ä¸‹ä¸€æ­¥æ‰§è¡Œçš„åŠ¨ä½œï¼Œå‘¨è€Œå¤å§‹ï¼Œç›´è‡³è¿­ä»£æ¬¡æ•°åˆ°è¾¾è®­ç»ƒæœŸ

* è®­ç»ƒæœŸï¼ˆTRAINï¼‰ ï¼šÎµ å·²ç»å¾ˆå°ï¼Œä¸å†å‘ç”Ÿæ”¹å˜ï¼Œç½‘ç»œå‚æ•°éšç€è®­ç»ƒè¿‡ç¨‹ä¸æ–­è¶‹äºç¨³å®šã€‚

  æœ¬é˜¶æ®µè·Ÿæ¢ç´¢æœŸçš„è¿‡ç¨‹ç›¸åŒï¼Œåªæ˜¯åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸å†ä¿®æ”¹Îµçš„å€¼ã€‚

------------------

#### æ¸¸æˆæ¨¡æ‹Ÿå™¨

ä½¿ç”¨Python çš„Pygameæ¨¡å—å®Œæˆçš„Flappy Birdæ¸¸æˆç¨‹åºï¼Œä¸ºäº†é…åˆè®­ç»ƒè¿‡ç¨‹ï¼Œåœ¨åŸæœ‰çš„æ¸¸æˆç¨‹åºåŸº
ç¡€ä¸Šè¿›è¡Œäº†ä¿®æ”¹ã€‚å‚è€ƒä»¥ä¸‹ç½‘å€æŸ¥çœ‹æ¸¸æˆæºç ï¼š

https://github.com/sourabhv/FlapPyBird

è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨è¿ç»­4å¸§å›¾åƒä½œä¸ºä¸€ä¸ªçŠ¶æ€sï¼Œç”¨äºç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚

#### åŠ¨ä½œé€‰æ‹©æ¨¡å—

ä¸ºÎµè´ªå¿ƒç­–ç•¥çš„ç®€å•åº”ç”¨ï¼Œä»¥æ¦‚ç‡Îµéšæœºä»åŠ¨ä½œç©ºé—´Aä¸­é€‰æ‹©åŠ¨ä½œï¼Œä»¥1-Îµæ¦‚ç‡ä¾é ç¥ç»ç½‘ç»œçš„è¾“å‡ºé€‰æ‹©åŠ¨ä½œ

#### æ·±åº¦ç¥ç»ç½‘ç»œCNN

DQNï¼šç”¨å·ç§¯ç¥ç»ç½‘ç»œå¯¹æ¸¸æˆç”»é¢è¿›è¡Œç‰¹å¾æå–ï¼Œè¿™ä¸ªæ­¥éª¤å¯ä»¥ç†è§£ä¸ºå¯¹çŠ¶æ€çš„æå–ã€‚
å·ç§¯ç¥ç»ç½‘ç»œ(CNN)ï¼šå³ä¾§å±•ç¤ºå·ç§¯æ“ä½œã€‚

å·ç§¯æ ¸ï¼šè¿™é‡Œçš„å·ç§¯æ ¸æŒ‡çš„å°±æ˜¯ç§»åŠ¨ä¸­3Ã—3å¤§å°çš„çŸ©é˜µã€‚

#### å·ç§¯æ“ä½œ

ä½¿ç”¨å·ç§¯æ ¸ä¸æ•°æ®è¿›è¡Œå¯¹åº”ä½ç½®çš„ä¹˜ç§¯å¹¶åŠ å’Œï¼Œä¸æ–­ç§»åŠ¨å·ç§¯æ ¸ç”Ÿæˆå·ç§¯åçš„ç‰¹å¾ã€‚

#### CNNæ± åŒ–æ“ä½œ

å¯¹å·ç§¯çš„ç»“æœè¿›è¡Œæ“ä½œã€‚æœ€å¸¸ç”¨çš„æ˜¯æœ€å¤§æ± åŒ–æ“ä½œï¼Œå³ä»å·ç§¯ç»“æœä¸­æŒ‘å‡ºæœ€å¤§å€¼ã€‚

#### å·ç§¯ç¥ç»ç½‘ç»œ

æŠŠImageçŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ å½“åšä¸€ä¸ªç¥ç»å…ƒï¼Œé‚£ä¹ˆå·ç§¯æ ¸å°±ç›¸å½“äºè¾“å…¥ç¥ç»å…ƒå’Œè¾“å‡ºç¥ç»å…ƒä¹‹é—´çš„é“¾æ¥æƒé‡ï¼Œç”±æ­¤æ„å»ºè€Œæˆçš„ç½‘ç»œè¢«ç§°ä½œå·ç§¯ç¥ç»ç½‘ç»œã€‚

æœ¬å®éªŒä¸­ä½¿ç”¨çš„æ·±åº¦ç¥ç»ç½‘ç»œç»“æ„å°±æ˜¯å¤šä¸ªå·ç§¯æ“ä½œå’Œæ± åŒ–æ“ä½œçš„ç´¯åŠ ã€‚

#### æ·±åº¦ç¥ç»ç½‘ç»œ

* å¯¹é‡‡é›†çš„4å¼ åŸå§‹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼Œå¾—åˆ°80\*80\*4å¤§å°çš„çŸ©é˜µï¼›
* ä½¿ç”¨32ä¸ª8\*8\*4å¤§å°æ­¥é•¿4çš„å·ç§¯æ ¸å¯¹ä»¥ä¸ŠçŸ©é˜µè¿›è¡Œå·ç§¯ï¼Œå¾—åˆ°20\*20\*32å¤§å°çš„çŸ©é˜µï¼›æ³¨ï¼šåœ¨tensorflowä¸­ä½¿ç”¨4ç»´å‘é‡è¡¨ç¤ºå·ç§¯æ ¸[è¾“å…¥é€šé“æ•°ï¼Œé«˜åº¦ï¼Œå®½åº¦ï¼Œè¾“å‡ºé€šé“æ•°]ï¼Œå¯¹åº”äºä¸Šé¢çš„[4,8,8,32]ï¼Œå¯ä»¥ç†è§£ä¸º32ä¸ª8\*8\*4å¤§å°çš„å·ç§¯æ ¸ï¼›
* å¯¹ä»¥ä¸ŠçŸ©é˜µè¿›è¡Œä¸é‡å çš„æ± åŒ–æ“ä½œï¼Œæ± åŒ–çª—å£ä¸º2\*2å¤§å°ï¼Œæ­¥é•¿ä¸º2ï¼Œå¾—åˆ°10\*10\*32å¤§å°çš„çŸ©é˜µï¼›
* ä½¿ç”¨64ä¸ª4\*4\*32å¤§å°æ­¥é•¿ä¸º2çš„å·ç§¯æ ¸å¯¹ä»¥ä¸ŠçŸ©é˜µè¿›è¡Œå·ç§¯ï¼Œå¾—åˆ°5\*5\*64çš„çŸ©é˜µï¼›
* ä½¿ç”¨64ä¸ª3\*3\*64å¤§å°æ­¥é•¿ä¸º1çš„å·ç§¯æ ¸å¯¹ä»¥ä¸ŠçŸ©é˜µè¿›è¡Œå·ç§¯ï¼Œå¾—åˆ°5\*5\*64çš„çŸ©é˜µï¼›
* å°†è¾“å‡ºçš„5\*5\*64å¤§å°çš„æ•°ç»„è¿›è¡Œreshapeï¼Œå¾—åˆ°1*1600å¤§å°çš„çŸ©é˜µï¼›
* åœ¨ä¹‹åæ·»åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œç¥ç»å…ƒä¸ªæ•°ä¸º 512.
* æœ€åä¸€å±‚ä¹Ÿæ˜¯ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œç¥ç»å…ƒä¸ªæ•°ä¸º2ï¼Œå¯¹åº”çš„æ˜¯å°±æ˜¯ä¸¤ä¸ªåŠ¨ä½œçš„åŠ¨ä½œå€¼å‡½æ•°ï¼›

é€šè¿‡è·å¾—è¾“å…¥sï¼Œç¥ç»ç½‘ç»œå°±èƒ½å¤Ÿï¼š

* è¾“å‡ºQ(s,a1)å’ŒQ(s,a2)æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ï¼Œå°±èƒ½å¤Ÿè¯„åˆ¤é‡‡ç”¨åŠ¨ä½œa1å’Œa2çš„ä¼˜åŠ£ï¼Œä»è€Œé€‰æ‹©è¦é‡‡å–çš„åŠ¨ä½œ
* åœ¨é€‰æ‹©å¹¶æ‰§è¡Œå®Œé‡‡ç”¨çš„åŠ¨ä½œåï¼Œæ¨¡æ‹Ÿå™¨ä¼šæ›´æ–°çŠ¶æ€å¹¶è¿”å›å›æŠ¥å€¼ï¼Œç„¶åå°†è¿™ä¸ªçŠ¶æ€è½¬ç§»è¿‡ç¨‹å­˜å‚¨è¿›Dè¿›è¡Œé‡‡æ · æ›´æ–°ç½‘ç»œå‚æ•° ã€‚

## tensorflowåŸºæœ¬ä½¿ç”¨

ç†è§£TensorFlow

* ä½¿ç”¨å›¾(graph)æ¥è¡¨ç¤ºè®¡ç®—ä»»åŠ¡ï¼›
* åœ¨è¢«ç§°ä¹‹ä¸ºä¼šè¯(Session)çš„ä¸Šä¸‹æ–‡contextä¸­æ‰§è¡Œå›¾ï¼›
* ä½¿ç”¨tensorï¼ˆå¼ é‡ï¼‰è¡¨ç¤ºæ•°æ®
* é€šè¿‡å˜é‡(Variable)ç»´æŠ¤çŠ¶æ€ï¼›
* ä½¿ç”¨feedå’Œfetchå¯ä»¥ä¸ºä»»æ„çš„æ“ä½œ(arbitrary operation)èµ‹å€¼æˆ–è€…ä»å…¶ä¸­è·å–æ•°æ®ã€‚

TensorFlowæ˜¯ä¸€ä¸ªç¼–ç¨‹ç³»ç»Ÿï¼Œä½¿ç”¨å›¾æ¥è¡¨ç¤ºè®¡ç®—ä»»åŠ¡ã€‚å›¾ä¸­çš„èŠ‚ç‚¹è¢«ç§°ä½œop(Operation)ã€‚opå¯ä»¥è·å¾—0ä¸ªæˆ–å¤šä¸ª tensorï¼Œäº§ç”Ÿ0ä¸ªæˆ–å¤šä¸ªtensorã€‚æ¯ä¸ªtensoræ˜¯ä¸€ä¸ªç±»å‹åŒ–çš„å¤šç»´æ•°ç»„ã€‚ä¾‹å¦‚ï¼šå¯ä»¥å°†ä¸€ç»„å›¾åƒé›†è¡¨ç¤ºæˆä¸€ä¸ªå››ç»´çš„æµ®ç‚¹æ•°ç»„ï¼Œå››ä¸ªç»´åº¦åˆ†åˆ«æ˜¯[batchï¼Œheightï¼Œweightï¼Œchannels] ã€‚
å›¾ï¼ˆgraphï¼‰æè¿°äº†è®¡ç®—çš„è¿‡ç¨‹ã€‚ä¸ºäº†è¿›è¡Œè®¡ç®—ï¼Œå›¾å¿…é¡»åœ¨ä¼šè¯ä¸­å¯åŠ¨ï¼Œä¼šè¯è´Ÿè´£å°†å›¾ä¸­çš„opåˆ†å‘åˆ°CPUæˆ–GPU ä¸Šè¿›è¡Œè®¡ç®—ï¼Œç„¶åå°†äº§ç”Ÿçš„tensorè¿”å›ã€‚åœ¨Pythonä¸­ï¼Œtensorå°±æ˜¯numpy.ndarrayå¯¹è±¡ã€‚

TensorFlowç¨‹åºé€šå¸¸è¢«ç»„ç»‡æˆä¸¤ä¸ªé˜¶æ®µï¼šæ„å»ºé˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µã€‚
æ„å»ºé˜¶æ®µï¼šopçš„æ‰§è¡Œé¡ºåºè¢«æè¿°æˆä¸€ä¸ªå›¾ï¼›
æ‰§è¡Œé˜¶æ®µï¼šä½¿ç”¨ä¼šè¯æ‰§è¡Œå›¾ä¸­çš„op ã€‚
ä¾‹å¦‚ï¼šé€šå¸¸åœ¨æ„å»ºé˜¶æ®µåˆ›å»ºä¸€ä¸ªå›¾æ¥è¡¨ç¤ºç¥ç»ç½‘ç»œï¼Œåœ¨æ‰§è¡Œé˜¶æ®µåå¤æ‰§è¡Œå›¾ä¸­çš„opè®­ç»ƒç¥ç»ç½‘ç»œã€‚

```assembly
>>>import tensorflow as tf #å¯¼å…¥tensorflowåº“
>>>mat1 = tf.constant([[3., 3 .]]) #åˆ›å»ºä¸€ä¸ª 1*2 çš„çŸ©é˜µ
>>>mat2 = tf.constant([[2.],[2 ]]) #åˆ›å»ºä¸€ä¸ª 2*1 çš„çŸ©é˜µ
>>>product = tf.matmul(mat1 , mat2) #åˆ›å»ºopæ‰§è¡Œä¸¤ä¸ªçŸ©é˜µçš„ä¹˜æ³•
>>>sess = tf.Session() #å¯åŠ¨é»˜è®¤å›¾
>>>res = sess.run(product) #åœ¨é»˜è®¤å›¾ä¸­æ‰§è¡Œ op æ“ä½œ
>>>print(res) #è¾“å‡ºä¹˜ç§¯ç»“æœ
[[ 12. ]]
>>>sess.close() #å…³é—­session
```

#### äº¤äº’å¼ä¼šè¯ï¼ˆInteractiveSessionï¼‰
ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨Ipythonä¹‹ç±»çš„Pythonäº¤äº’ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨äº¤äº’å¼ä¼šè¯ï¼ˆInteractiveSessionï¼‰æ¥ä»£æ›¿Sessionï¼Œä½¿ç”¨ç±»ä¼¼Tensor.run()å’ŒOperation.eval()æ¥ä»£æ›¿Session.run()ï¼Œé¿å…ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æŒæœ‰ä¼šè¯ã€‚

```assembly
>>>import tensorflow as tf #å¯¼å…¥tensorflowåº“
>>>sess = tf.InteractiveSession() #åˆ›å»ºäº¤äº’å¼ä¼šè¯
>>>a = tf.Variable([1.0, 2.0]) #åˆ›å»ºå˜é‡æ•°ç»„
>>>b = tf.constant([3.0, 4.0]) #åˆ›å»ºå¸¸é‡æ•°ç»„
>>>sess.run(tf.global_variables_initializer()) #å˜é‡åˆå§‹åŒ–
>>>res = tf.add(a, b) #åˆ›å»ºåŠ æ³•æ“ä½œ
>>>print( res.eval()) #æ‰§è¡Œæ“ä½œå¹¶è¾“å‡ºç»“æœ
[4. 5.]
```

#### Feedæ“ä½œ
å‰é¢çš„ä¾‹å­ä¸­ï¼Œæ•°æ®å‡ä»¥å˜é‡æˆ–å¸¸é‡çš„å½¢å¼è¿›è¡Œå­˜å‚¨ã€‚Tensorflowè¿˜æä¾›äº† Feed æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å¯ä»¥ä¸´æ—¶æ›¿ä»£å›¾ä¸­ä»»æ„æ“ä½œä¸­çš„tensorã€‚æœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯ä½¿ç”¨tf.placeholder()åˆ›å»ºå ä½ç¬¦ï¼Œç›¸å½“äºæ˜¯ä½œä¸ºå›¾ä¸­çš„è¾“å…¥ï¼Œç„¶åä½¿ç”¨Feedæœºåˆ¶å‘å›¾ä¸­å ä½ç¬¦æä¾›æ•°æ®è¿›è¡Œè®¡ç®—.

```assembly
>>>import tensorflow as tf #å¯¼å…¥tensorflowåº“
>>>sess = tf.InteractiveSession() #åˆ›å»ºäº¤äº’å¼ä¼šè¯
>>>input1 = tf.placeholder(tf.float32) #åˆ›å»ºå ä½ç¬¦
>>>input2 = tf.placeholder(tf.float32) #åˆ›å»ºå ä½ç¬¦
>>>res = tf.mul(input1, input2) #åˆ›å»ºä¹˜æ³•æ“ä½œ
>>>res.eval( feed_dict ={input1:[7.], input2:[2]} ) #æ±‚å€¼
array([14.], dtype = float32)
```

### è‡ªä¸»å­¦ä¹ flappy birdå®ä¾‹ç¨‹åºç¼–å†™