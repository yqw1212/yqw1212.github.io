---
layout: post
title:  Web2.0(FlareOn5)
date:   2021-10-29 00:08:01 +0300
image:  2021-10-29-boy.jpg
tags:   [ctf,reverse,wasm,FlareOn]
---

é¦–å…ˆåœ¨é¢˜ç›®ç›®å½•ä¸‹å¼€å¯httpæœåŠ¡

> python -m http.server

chromeæµè§ˆå™¨è¾“å…¥ç½‘å€

> http://localhost:8000/

é¡µé¢ä¸º

ğŸ’©

æŸ¥çœ‹JavaScriptä»£ç ï¼ŒåŸæ¥è¦è¾“å‡ºä¸€ä¸ªå‚æ•°q

> http://localhost:8000/?q=melody

åœ¨JavaScriptä»£ç ä¸­æ‰¾åˆ°å¯¹å¯¹ç»“æœçš„æ¯”è¾ƒ

```assembly
if (instance.exports.Match(pa, a.byteLength, pb, b.byteLength) == 1) {
    // PARTY POPPER
    document.getElementById("container").innerText = "ğŸ‰";
} else {
    // PILE OF POO
    document.getElementById("container").innerText = "ğŸ’©";
}
```

å‘ç°Matchä¸ºwasmä¸­çš„å‡½æ•°ï¼Œå³Matchä¸ºwasmç¨‹åºçš„å…¥å£ï¼Œåœ¨Matchå¤„ä¸‹æ–­ç‚¹ï¼Œæ³¨æ„ä¸è¦ä¸‹åœ¨ifå¤„ã€‚

![]({{site.baseurl}}/img/2021-10-29-breakpoint.jpg)

è¿è¡Œç¨‹åºï¼Œç¨‹åºæ–­åœ¨äº†æ–­ç‚¹å¤„ï¼Œæ­¥å…¥ï¼Œç„¶åæ…¢æ…¢è°ƒè¯•ã€‚

é€šè¿‡è°ƒè¯•å­¦ä¹ ä¸€ä¸‹wasmçš„æŒ‡ä»¤

èµ‹å€¼ï¼Œæ‰§è¡Œç¬¬ä¸€å¥æ—¶ï¼Œå…ˆæŠŠå˜é‡å‹å…¥æ ˆä¸­ï¼Œæ‰§è¡Œç¬¬äºŒå¥æ‰§è¡Œä»¤æ—¶ï¼ŒæŠŠæ ˆé¡¶çš„å€¼å†å¼¹å‡ºèµ‹ç»™å˜é‡ã€‚

```assembly
i32.const 32
local.set $var5
```

addï¼ŒåŒç†ï¼ŒgetæŒ‡ä»¤æŠŠå˜é‡çš„å€¼å‹å…¥æ ˆä¸­ï¼ŒaddæŒ‡ä»¤å¼¹å‡ºæ ˆé¡¶çš„ä¸¤ä¸ªå€¼è¿›è¡Œaddè®¡ç®—å¹¶å°†ç»“æœå‹å…¥æ ˆä¸­ï¼ŒsetæŒ‡ä»¤å°†æ ˆé¡¶çš„å€¼å¼¹å‡ºèµ‹ç»™å˜é‡ã€‚

```assembly
local.get $var6
local.get $var8
i32.add
local.set $var9
```

wasm

å˜é‡ï¼Œiè¡¨ç¤ºæ•´æ•°ï¼Œfè¡¨ç¤ºæµ®ç‚¹æ•°

- `i32.const`
- `i64.const`
- `f32.const`
- `f64.const`

è¿ç®—

- `i32.add`: sign-agnostic addition
- `i32.sub`: sign-agnostic subtraction
- `i32.mul`: sign-agnostic multiplication (lower 32-bits)
- `i32.div_s`: signed division (result is truncated toward zero)
- `i32.div_u`: unsigned division (result is floored)
- `i32.rem_s`: signed remainder (result has the sign of the dividend)
- `i32.rem_u`: unsigned remainder

æ¯”ç‰¹è¿ç®—

- `i32.and`: sign-agnostic bitwise and
- `i32.or`: sign-agnostic bitwise inclusive or
- `i32.xor`: sign-agnostic bitwise exclusive or
- `i32.shl`: sign-agnostic shift left
- `i32.shr_u`: zero-replicating (logical) shift right
- `i32.shr_s`: sign-replicating (arithmetic) shift right
- `i32.rotl`: sign-agnostic rotate left
- `i32.rotr`: sign-agnostic rotate right

æ¯”è¾ƒè¿ç®—

- `i32.eq`: sign-agnostic compare equal
- `i32.ne`: sign-agnostic compare unequal
- `i32.lt_s`: signed less than
- `i32.le_s`: signed less than or equal
- `i32.lt_u`: unsigned less than
- `i32.le_u`: unsigned less than or equal
- `i32.gt_s`: signed greater than
- `i32.ge_s`: signed greater than or equal
- `i32.gt_u`: unsigned greater than
- `i32.ge_u`: unsigned greater than or equal

æ ¹æ®é€†å‘ç»éªŒï¼Œè°ƒè¯•æ—¶ä¸»è¦æ³¨æ„æ¯”è¾ƒçš„åœ°æ–¹ï¼Œå³`i32.eq`æŒ‡ä»¤

å•æ­¥è°ƒè¯•ç›´åˆ°0xbf2ï¼Œ

![]({{site.baseurl}}/img/2021-10-29-bf2.jpg)

![]({{site.baseurl}}/img/2021-10-29-stack1.jpg)

å¯¹ä¸¤ä¸ªæ•°è¿›è¡Œæ¯”è¾ƒï¼Œé€šè¿‡éªŒè¯

```assembly
>>> chr(119)
'w'
>>> chr(109)
'm'
```

$var83ä¸­çš„æ˜¯æˆ‘ä»¬è¾“å…¥çš„å€¼ï¼Œ$var82æ˜¯æ­£ç¡®çš„å€¼ã€‚

ç»§ç»­è¿è¡Œï¼Œå†æ¬¡åˆ°è¾¾0xbf2ï¼Œæ ˆä¸­çš„å€¼è¯æ˜äº†æˆ‘ä»¬çš„çŒœæµ‹

![]({{site.baseurl}}/img/2021-10-29-stack2.jpg)

```assembly
>>> chr(97)
'a'
>>> chr(101)
'e'
```

è¾“å…¥å·²çŸ¥æ­£ç¡®çš„å­—ç¬¦ä¸²ï¼Œç„¶åç›´æ¥åœ¨0xbf2å¤„ä¸‹æ–­ç‚¹,æ¯æ¬¡åœåœ¨è¿™é‡Œæ—¶æŸ¥çœ‹`$var82`çš„å€¼ï¼Œæœ€åå¾—åˆ°

119,97,115,109,95,114,117,108,101,122,95,106,115,95,100,114,111,111,108,122,64,102,108,97,114,101,45,111,110,46,99,111,109

pythonè½¬åŒ–

```assembly
data = [119,97,115,109,95,114,117,108,101,122,95,106,115,95,100,114,111,111,108,122,64,102,108,97,114,101,45,111,110,46,99,111,109]
flag = ""
for i in data:
    flag += chr(i)

print(flag)
```

wasm_rulez_js_droolz@flare-on.com